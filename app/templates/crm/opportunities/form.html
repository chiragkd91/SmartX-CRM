<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if opportunity %}Edit Opportunity{% else %}New Opportunity{% endif %}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-section {
            margin-bottom: 30px;
        }
        .form-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        .required {
            color: #dc3545;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        .field-error {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{% if opportunity %}Edit Opportunity{% else %}New Opportunity{% endif %}</h1>
            <div>
                <a href="/crm/opportunities" class="btn btn-primary">Back to Opportunities</a>
                <a href="/crm/dashboard" class="btn btn-warning">Dashboard</a>
            </div>
        </div>

        {% if error %}
        <div class="error">
            {{ error }}
        </div>
        {% endif %}

        {% if success %}
        <div class="success">
            {{ success }}
        </div>
        {% endif %}

        <div class="form-container">
            <form method="POST" action="{% if opportunity %}/crm/opportunities/{{ opportunity.id }}/edit{% else %}/crm/opportunities/new{% endif %}">
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">Opportunity Name <span class="required">*</span></label>
                            <input type="text" id="name" name="name" value="{{ opportunity.name if opportunity else '' }}" required>
                            {% if form_errors and form_errors.name %}
                            <div class="field-error">{{ form_errors.name }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="account_id">Account <span class="required">*</span></label>
                            <select id="account_id" name="account_id" required>
                                <option value="">Select Account</option>
                                {% for account in accounts %}
                                <option value="{{ account.id }}" {% if opportunity and opportunity.account_id == account.id %}selected{% endif %}>
                                    {{ account.name }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form_errors and form_errors.account_id %}
                            <div class="field-error">{{ form_errors.account_id }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stage">Stage <span class="required">*</span></label>
                            <select id="stage" name="stage" required>
                                <option value="">Select Stage</option>
                                <option value="Prospecting" {% if opportunity and opportunity.stage == 'Prospecting' %}selected{% endif %}>Prospecting</option>
                                <option value="Qualification" {% if opportunity and opportunity.stage == 'Qualification' %}selected{% endif %}>Qualification</option>
                                <option value="Proposal" {% if opportunity and opportunity.stage == 'Proposal' %}selected{% endif %}>Proposal</option>
                                <option value="Negotiation" {% if opportunity and opportunity.stage == 'Negotiation' %}selected{% endif %}>Negotiation</option>
                                <option value="Closed Won" {% if opportunity and opportunity.stage == 'Closed Won' %}selected{% endif %}>Closed Won</option>
                                <option value="Closed Lost" {% if opportunity and opportunity.stage == 'Closed Lost' %}selected{% endif %}>Closed Lost</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="type">Opportunity Type</label>
                            <select id="type" name="type">
                                <option value="">Select Type</option>
                                <option value="New Business" {% if opportunity and opportunity.type == 'New Business' %}selected{% endif %}>New Business</option>
                                <option value="Existing Business" {% if opportunity and opportunity.type == 'Existing Business' %}selected{% endif %}>Existing Business</option>
                                <option value="Renewal" {% if opportunity and opportunity.type == 'Renewal' %}selected{% endif %}>Renewal</option>
                                <option value="Upgrade" {% if opportunity and opportunity.type == 'Upgrade' %}selected{% endif %}>Upgrade</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Financial Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount">Amount <span class="required">*</span></label>
                            <input type="number" id="amount" name="amount" value="{{ opportunity.amount if opportunity else '' }}" min="0" step="1000" required>
                            {% if form_errors and form_errors.amount %}
                            <div class="field-error">{{ form_errors.amount }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="probability">Probability (%)</label>
                            <input type="number" id="probability" name="probability" value="{{ opportunity.probability if opportunity else '' }}" min="0" max="100" step="5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="close_date">Expected Close Date <span class="required">*</span></label>
                            <input type="date" id="close_date" name="close_date" value="{{ opportunity.close_date.strftime('%Y-%m-%d') if opportunity and opportunity.close_date else '' }}" required>
                            {% if form_errors and form_errors.close_date %}
                            <div class="field-error">{{ form_errors.close_date }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency" name="currency">
                                <option value="USD" {% if opportunity and opportunity.currency == 'USD' %}selected{% endif %}>USD</option>
                                <option value="EUR" {% if opportunity and opportunity.currency == 'EUR' %}selected{% endif %}>EUR</option>
                                <option value="GBP" {% if opportunity and opportunity.currency == 'GBP' %}selected{% endif %}>GBP</option>
                                <option value="CAD" {% if opportunity and opportunity.currency == 'CAD' %}selected{% endif %}>CAD</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Assignment & Contacts</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assigned_to">Assigned To</label>
                            <select id="assigned_to" name="assigned_to">
                                <option value="">Select User</option>
                                {% for user in users %}
                                <option value="{{ user.id }}" {% if opportunity and opportunity.assigned_to == user.id %}selected{% endif %}>
                                    {{ user.first_name }} {{ user.last_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contact_id">Primary Contact</label>
                            <select id="contact_id" name="contact_id">
                                <option value="">Select Contact</option>
                                {% for contact in contacts %}
                                <option value="{{ contact.id }}" {% if opportunity and opportunity.contact_id == contact.id %}selected{% endif %}>
                                    {{ contact.first_name }} {{ contact.last_name }} - {{ contact.account.name if contact.account else 'No Account' }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Additional Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" placeholder="Enter opportunity description...">{{ opportunity.description if opportunity else '' }}</textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" name="notes" placeholder="Enter additional notes...">{{ opportunity.notes if opportunity else '' }}</textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="next_step">Next Step</label>
                            <input type="text" id="next_step" name="next_step" value="{{ opportunity.next_step if opportunity else '' }}" placeholder="e.g., Schedule demo, Send proposal">
                        </div>
                        <div class="form-group">
                            <label for="lead_source">Lead Source</label>
                            <select id="lead_source" name="lead_source">
                                <option value="">Select Source</option>
                                <option value="Website" {% if opportunity and opportunity.lead_source == 'Website' %}selected{% endif %}>Website</option>
                                <option value="LinkedIn" {% if opportunity and opportunity.lead_source == 'LinkedIn' %}selected{% endif %}>LinkedIn</option>
                                <option value="Referral" {% if opportunity and opportunity.lead_source == 'Referral' %}selected{% endif %}>Referral</option>
                                <option value="Cold Call" {% if opportunity and opportunity.lead_source == 'Cold Call' %}selected{% endif %}>Cold Call</option>
                                <option value="Trade Show" {% if opportunity and opportunity.lead_source == 'Trade Show' %}selected{% endif %}>Trade Show</option>
                                <option value="Email Campaign" {% if opportunity and opportunity.lead_source == 'Email Campaign' %}selected{% endif %}>Email Campaign</option>
                                <option value="Social Media" {% if opportunity and opportunity.lead_source == 'Social Media' %}selected{% endif %}>Social Media</option>
                                <option value="Other" {% if opportunity and opportunity.lead_source == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="/crm/opportunities" class="btn btn-warning">Cancel</a>
                    <button type="submit" class="btn btn-success">
                        {% if opportunity %}Update Opportunity{% else %}Create Opportunity{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</body>
</html> 